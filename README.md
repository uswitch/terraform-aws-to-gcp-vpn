# VPN Tunnels between AWS and GCP

This repository contains the infrastructure to create HA VPNs between an AWS VPC and a GCP project.

The infrastructure created was based on following this guide [here](https://cloud.google.com/community/tutorials/using-ha-vpn-with-aws)

Note: This will require using Terraform 0.12

## High-level configuration steps
Because HA VPN is dependent on BGP IP settings generated by AWS, you must configure Cloud VPN and AWS components in the following sequence:

1. Create the HA VPN gateway and create a Cloud Router.
2. Create one AWS virtual private gateway.
3. Create two AWS site-to-site VPN connections and two customer gateways.
4. Create four VPN tunnels on the HA VPN gateway.
5. Configure BGP sessions on the Cloud Router using the BGP IP addresses from AWS

## Example
In this repository is an example of how to use the module and the variables to be passed to the module.

In the example, instances and security groups are created in AWS and GCP allowing you to SSH on to the respective instances and ping the other instance to confirm connectivity.

To get the example to run, add an `inputs.tfvars` file with the values for the variables in `variables.tf` and run `terraform plan --var-file=inputs.tfvars` and `terraform apply --var-file=inputs.tfvars`
